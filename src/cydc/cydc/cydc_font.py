# -- coding: utf-8 -*-
#
# Choose Your Destiny.
#
# Copyright (C) 2024 Sergio Chico <cronomantic@gmail.com>
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <https://www.gnu.org/licenses/>.

import json

class CydcFont(object):
    default_font = [
        # Control characters?
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        #6x8 character set
        0x00,0x20,0x50,0x30,0x00,0x70,0x00,0x00,
        0x20,0x00,0x20,0x20,0x20,0x20,0x20,0x00,
        0x20,0x00,0x20,0x40,0x88,0x88,0x70,0x00,
        0x00,0x00,0x28,0x50,0xA0,0x50,0x28,0x00,
        0x00,0x00,0xA0,0x50,0x28,0x50,0xA0,0x00,
        0x20,0x40,0x00,0x68,0x98,0x98,0x68,0x00,
        0x10,0x20,0x70,0x88,0xF8,0x80,0x78,0x00,
        0x10,0x20,0x00,0x60,0x20,0x20,0x70,0x00,
        0x10,0x20,0x00,0x70,0x88,0x88,0x70,0x00,
        0x10,0x20,0x00,0x88,0x88,0x88,0x70,0x00,
        0x28,0x50,0x00,0xB0,0xC8,0x88,0x88,0x00,
        0x28,0x50,0x88,0xC8,0xA8,0x98,0x88,0x00,
        0x00,0x70,0x88,0x80,0x88,0x70,0x20,0x40,
        0x70,0x88,0x80,0x80,0x88,0x70,0x20,0x40,
        0x00,0x50,0x00,0x88,0x88,0x88,0x70,0x00,
        0x50,0x00,0x88,0x88,0x88,0x88,0x70,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x20,0x20,0x20,0x20,0x20,0x00,0x20,0x00,
        0x50,0x50,0x00,0x00,0x00,0x00,0x00,0x00,
        0x50,0xF8,0x50,0x50,0x50,0xF8,0x50,0x00,
        0x20,0xF8,0xA0,0xF8,0x28,0xF8,0x20,0x00,
        0xC8,0xC8,0x10,0x20,0x40,0x98,0x98,0x00,
        0x20,0x50,0x20,0x60,0x98,0x90,0x68,0x00,
        0x20,0x40,0x00,0x00,0x00,0x00,0x00,0x00,
        0x08,0x10,0x10,0x10,0x10,0x10,0x08,0x00,
        0x40,0x20,0x20,0x20,0x20,0x20,0x40,0x00,
        0xA8,0xA8,0x70,0xF8,0x70,0xA8,0xA8,0x00,
        0x00,0x20,0x20,0xF8,0x20,0x20,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x10,0x10,0x20,
        0x00,0x00,0x00,0x78,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x30,0x30,0x00,
        0x08,0x08,0x10,0x20,0x40,0x80,0x80,0x00,
        0x70,0x98,0x98,0xA8,0xC8,0xC8,0x70,0x00,
        0x20,0x60,0x20,0x20,0x20,0x20,0x70,0x00,
        0x70,0x88,0x08,0x70,0x80,0x80,0xF8,0x00,
        0x70,0x88,0x08,0x30,0x08,0x88,0x70,0x00,
        0x10,0x30,0x50,0x90,0xF8,0x10,0x10,0x00,
        0xF8,0x80,0x80,0xF0,0x08,0x88,0x70,0x00,
        0x70,0x88,0x80,0xF0,0x88,0x88,0x70,0x00,
        0xF8,0x08,0x08,0x10,0x10,0x20,0x20,0x00,
        0x70,0x88,0x88,0x70,0x88,0x88,0x70,0x00,
        0x70,0x88,0x88,0x78,0x08,0x88,0x70,0x00,
        0x00,0x00,0x20,0x00,0x00,0x20,0x00,0x00,
        0x00,0x00,0x20,0x00,0x00,0x20,0x20,0x40,
        0x00,0x08,0x10,0x20,0x20,0x10,0x08,0x00,
        0x00,0x00,0x00,0x78,0x00,0x78,0x00,0x00,
        0x00,0x40,0x20,0x10,0x10,0x20,0x40,0x00,
        0x70,0x88,0x88,0x10,0x20,0x00,0x20,0x00,
        0x00,0x70,0x88,0xA8,0xB8,0x80,0x70,0x00,
        0x70,0x88,0x88,0xF8,0x88,0x88,0x88,0x00,
        0xF0,0x88,0x88,0xF0,0x88,0x88,0xF0,0x00,
        0x70,0x88,0x80,0x80,0x80,0x88,0x70,0x00,
        0xF0,0x88,0x88,0x88,0x88,0x88,0xF0,0x00,
        0xF8,0x80,0x80,0xF0,0x80,0x80,0xF8,0x00,
        0xF8,0x80,0x80,0xF0,0x80,0x80,0x80,0x00,
        0x70,0x88,0x80,0x80,0x98,0x88,0x70,0x00,
        0x88,0x88,0x88,0xF8,0x88,0x88,0x88,0x00,
        0x70,0x20,0x20,0x20,0x20,0x20,0x70,0x00,
        0x08,0x08,0x08,0x08,0x08,0x88,0x70,0x00,
        0x88,0x90,0xA0,0xC0,0xA0,0x90,0x88,0x00,
        0x80,0x80,0x80,0x80,0x80,0x80,0xF8,0x00,
        0x88,0xD8,0xA8,0x88,0x88,0x88,0x88,0x00,
        0x88,0x88,0xC8,0xA8,0x98,0x88,0x88,0x00,
        0x70,0x88,0x88,0x88,0x88,0x88,0x70,0x00,
        0xF0,0x88,0x88,0xF0,0x80,0x80,0x80,0x00,
        0x70,0x88,0x88,0x88,0xA8,0x98,0x78,0x00,
        0xF0,0x88,0x88,0xF0,0x90,0x88,0x88,0x00,
        0x70,0x88,0x80,0x70,0x08,0x88,0x70,0x00,
        0xF8,0x20,0x20,0x20,0x20,0x20,0x20,0x00,
        0x88,0x88,0x88,0x88,0x88,0x88,0x70,0x00,
        0x88,0x88,0x88,0x88,0x88,0x50,0x20,0x00,
        0x88,0x88,0x88,0x88,0xA8,0xA8,0x50,0x00,
        0x88,0x88,0x50,0x20,0x50,0x88,0x88,0x00,
        0x88,0x88,0x50,0x20,0x20,0x20,0x20,0x00,
        0xF8,0x08,0x10,0x20,0x40,0x80,0xF8,0x00,
        0x38,0x20,0x20,0x20,0x20,0x20,0x38,0x00,
        0x80,0x80,0x40,0x20,0x10,0x08,0x08,0x00,
        0x70,0x10,0x10,0x10,0x10,0x10,0x70,0x00,
        0x20,0x70,0xA8,0x20,0x20,0x20,0x20,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0xFC,0x00,
        0x30,0x48,0x40,0xF0,0x40,0x40,0xF8,0x00,
        0x00,0x00,0x68,0x98,0x88,0x98,0x68,0x00,
        0x80,0x80,0xB0,0xC8,0x88,0xC8,0xB0,0x00,
        0x00,0x00,0x70,0x88,0x80,0x88,0x70,0x00,
        0x08,0x08,0x68,0x98,0x88,0x98,0x68,0x00,
        0x00,0x00,0x70,0x88,0xF0,0x80,0x78,0x00,
        0x30,0x48,0x40,0x60,0x40,0x40,0x40,0x00,
        0x00,0x00,0x70,0x88,0x88,0x78,0x08,0x70,
        0x80,0x80,0xB0,0xC8,0x88,0x88,0x88,0x00,
        0x20,0x00,0x60,0x20,0x20,0x20,0x70,0x00,
        0x10,0x00,0x10,0x10,0x10,0x90,0x60,0x00,
        0x80,0x80,0x80,0xA0,0xC0,0xA0,0x90,0x00,
        0x40,0x40,0x40,0x40,0x40,0x40,0x30,0x00,
        0x00,0x00,0xD0,0xA8,0xA8,0xA8,0xA8,0x00,
        0x00,0x00,0xB0,0xC8,0x88,0x88,0x88,0x00,
        0x00,0x00,0x70,0x88,0x88,0x88,0x70,0x00,
        0x00,0x00,0xB0,0xC8,0x88,0xF0,0x80,0x80,
        0x00,0x00,0x68,0x98,0x88,0x78,0x08,0x0C,
        0x00,0x00,0xB0,0x40,0x40,0x40,0x40,0x00,
        0x00,0x00,0x70,0x80,0x70,0x08,0xF0,0x00,
        0x00,0x40,0xE0,0x40,0x40,0x40,0x30,0x00,
        0x00,0x00,0x88,0x88,0x88,0x88,0x70,0x00,
        0x00,0x00,0x88,0x88,0x50,0x50,0x20,0x00,
        0x00,0x00,0x88,0xA8,0xA8,0xA8,0x50,0x00,
        0x00,0x00,0x88,0x50,0x20,0x50,0x88,0x00,
        0x00,0x00,0x88,0x88,0x98,0x68,0x08,0x70,
        0x00,0x00,0xF8,0x10,0x20,0x40,0xF8,0x00,
        0x18,0x20,0x20,0x40,0x20,0x20,0x18,0x00,
        0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x00,
        0x60,0x10,0x10,0x08,0x10,0x10,0x60,0x00,
        0x00,0x28,0x50,0x00,0x00,0x00,0x00,0x00,
#-- extended chars
        # Option no selected
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        # Animation Cycle for selected option
        0x10,0x18,0x1C,0xFE,0xFE,0x1C,0x18,0x10,
        0x00,0x10,0x18,0xFE,0xFE,0x18,0x10,0x00,
        0x00,0x10,0x18,0xFE,0xFE,0x18,0x10,0x00,
        0x00,0x00,0x00,0xFE,0xFE,0x00,0x00,0x00,
        0x00,0x00,0x18,0xFE,0xFE,0x18,0x00,0x00,
        0x00,0x10,0x18,0xFE,0xFE,0x18,0x10,0x00,
        0x00,0x10,0x18,0xFE,0xFE,0x18,0x10,0x00,
        0x10,0x18,0x1C,0xFE,0xFE,0x1C,0x18,0x10,
        # Animation Cycle for wait
        0x18,0x18,0x18,0x18,0x18,0x7E,0x3C,0x18,
        0x00,0x18,0x18,0x18,0x7E,0x3C,0x18,0x00,
        0x00,0x00,0x18,0x18,0x7E,0x18,0x00,0x00,
        0x00,0x00,0x00,0x7E,0x00,0x00,0x00,0x00,
        0x00,0x00,0x18,0x18,0x7E,0x3C,0x18,0x00,
        0x00,0x18,0x18,0x18,0x7E,0x3C,0x18,0x00,
        0x18,0x18,0x18,0x18,0x18,0x7E,0x3C,0x18,
        0x18,0x18,0x18,0x18,0x18,0x7E,0x3C,0x18,
        #4x8 character set
        0x00,0xC0,0xA0,0xE0,0x00,0xE0,0x00,0x00,
        0x00,0x20,0x00,0x20,0x20,0x20,0x20,0x00,
        0x00,0x20,0x00,0x20,0x40,0x50,0x20,0x00,
        0x00,0x00,0x50,0xA0,0x50,0x00,0x00,0x00,
        0x00,0x00,0xA0,0x50,0xA0,0x00,0x00,0x00,
        0x00,0x10,0x60,0x10,0x30,0x50,0x30,0x00,
        0x00,0x10,0x20,0x50,0x60,0x40,0x30,0x00,
        0x10,0x20,0x00,0x60,0x20,0x20,0x70,0x00,
        0x00,0x10,0x20,0x50,0x50,0x50,0x20,0x00,
        0x10,0x20,0x00,0x50,0x50,0x50,0x20,0x00,
        0x00,0x60,0x00,0x60,0x50,0x50,0x50,0x00,
        0x70,0x00,0x50,0x70,0x70,0x50,0x50,0x00,
        0x00,0x00,0x20,0x50,0x40,0x50,0x20,0x40,
        0x00,0x20,0x50,0x40,0x40,0x50,0x20,0x40,
        0x00,0x50,0x00,0x50,0x50,0x50,0x20,0x00,
        0x50,0x00,0x50,0x50,0x50,0x50,0x20,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x20,0x20,0x20,0x20,0x00,0x20,0x00,
        0x00,0x50,0x50,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x20,0x70,0x20,0x70,0x20,0x00,
        0x00,0x20,0x70,0x40,0x70,0x10,0x70,0x20,
        0x00,0x50,0x10,0x20,0x20,0x40,0x50,0x00,
        0x00,0x20,0x50,0x20,0x60,0x50,0x60,0x00,
        0x00,0x20,0x40,0x00,0x00,0x00,0x00,0x00,
        0x00,0x20,0x40,0x40,0x40,0x40,0x20,0x00,
        0x00,0x40,0x20,0x20,0x20,0x20,0x40,0x00,
        0x00,0x00,0x50,0x20,0x70,0x20,0x50,0x00,
        0x00,0x00,0x20,0x20,0x70,0x20,0x20,0x00,
        0x00,0x00,0x00,0x00,0x00,0x20,0x20,0x40,
        0x00,0x00,0x00,0x00,0x70,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x60,0x60,0x00,
        0x00,0x10,0x10,0x20,0x20,0x40,0x40,0x00,
        0x00,0x20,0x50,0x50,0x50,0x50,0x20,0x00,
        0x00,0x20,0x60,0x20,0x20,0x20,0x70,0x00,
        0x00,0x20,0x50,0x10,0x20,0x40,0x70,0x00,
        0x00,0x20,0x50,0x20,0x10,0x50,0x20,0x00,
        0x00,0x50,0x50,0x70,0x10,0x10,0x10,0x00,
        0x00,0x70,0x40,0x60,0x10,0x50,0x20,0x00,
        0x00,0x30,0x40,0x60,0x50,0x50,0x20,0x00,
        0x00,0x70,0x10,0x10,0x20,0x40,0x40,0x00,
        0x00,0x20,0x50,0x20,0x50,0x50,0x20,0x00,
        0x00,0x20,0x50,0x50,0x30,0x50,0x20,0x00,
        0x00,0x00,0x00,0x20,0x00,0x20,0x00,0x00,
        0x00,0x00,0x20,0x00,0x00,0x20,0x20,0x40,
        0x00,0x00,0x10,0x20,0x40,0x20,0x10,0x00,
        0x00,0x00,0x00,0x70,0x00,0x70,0x00,0x00,
        0x00,0x00,0x40,0x20,0x10,0x20,0x40,0x00,
        0x00,0x20,0x50,0x10,0x20,0x00,0x20,0x00,
        0x00,0x60,0x90,0xB0,0xB0,0x80,0x60,0x00,
        0x00,0x20,0x50,0x70,0x50,0x50,0x50,0x00,
        0x00,0x60,0x50,0x60,0x50,0x50,0x60,0x00,
        0x00,0x20,0x50,0x40,0x40,0x50,0x20,0x00,
        0x00,0x60,0x50,0x50,0x50,0x50,0x60,0x00,
        0x00,0x70,0x40,0x60,0x40,0x40,0x70,0x00,
        0x00,0x70,0x40,0x70,0x40,0x40,0x40,0x00,
        0x00,0x20,0x50,0x40,0x70,0x50,0x20,0x00,
        0x00,0x50,0x50,0x70,0x50,0x50,0x50,0x00,
        0x00,0x70,0x20,0x20,0x20,0x20,0x70,0x00,
        0x00,0x30,0x10,0x10,0x10,0x50,0x20,0x00,
        0x00,0x50,0x50,0x60,0x50,0x50,0x50,0x00,
        0x00,0x40,0x40,0x40,0x40,0x40,0x70,0x00,
        0x00,0x50,0x70,0x70,0x50,0x50,0x50,0x00,
        0x00,0x50,0x50,0x70,0x70,0x50,0x50,0x00,
        0x00,0x20,0x50,0x50,0x50,0x50,0x20,0x00,
        0x00,0x60,0x50,0x50,0x60,0x40,0x40,0x00,
        0x00,0x20,0x50,0x50,0x70,0x70,0x30,0x00,
        0x00,0x60,0x50,0x50,0x60,0x50,0x50,0x00,
        0x00,0x20,0x50,0x20,0x10,0x50,0x20,0x00,
        0x00,0x70,0x20,0x20,0x20,0x20,0x20,0x00,
        0x00,0x50,0x50,0x50,0x50,0x50,0x20,0x00,
        0x00,0x50,0x50,0x50,0x50,0x20,0x20,0x00,
        0x00,0x50,0x50,0x50,0x70,0x70,0x50,0x00,
        0x00,0x50,0x50,0x20,0x50,0x50,0x50,0x00,
        0x00,0x50,0x50,0x50,0x20,0x20,0x20,0x00,
        0x00,0x70,0x10,0x20,0x20,0x40,0x70,0x00,
        0x00,0x70,0x40,0x40,0x40,0x40,0x70,0x00,
        0x00,0x40,0x40,0x20,0x20,0x10,0x10,0x00,
        0x00,0x70,0x10,0x10,0x10,0x10,0x70,0x00,
        0x00,0x20,0x70,0x20,0x20,0x20,0x20,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0xF0,0x00,
        0x00,0x20,0x50,0x40,0x60,0x40,0x70,0x00,
        0x00,0x00,0x60,0x10,0x30,0x50,0x30,0x00,
        0x00,0x40,0x40,0x60,0x50,0x50,0x60,0x00,
        0x00,0x00,0x20,0x50,0x40,0x50,0x20,0x00,
        0x00,0x10,0x10,0x30,0x50,0x50,0x20,0x00,
        0x00,0x00,0x20,0x50,0x60,0x40,0x30,0x00,
        0x00,0x20,0x50,0x40,0x60,0x40,0x40,0x00,
        0x00,0x00,0x20,0x50,0x50,0x30,0x50,0x20,
        0x00,0x40,0x40,0x60,0x50,0x50,0x50,0x00,
        0x00,0x20,0x00,0x60,0x20,0x20,0x70,0x00,
        0x00,0x10,0x00,0x30,0x10,0x10,0x50,0x20,
        0x00,0x40,0x40,0x50,0x60,0x50,0x50,0x00,
        0x00,0x40,0x40,0x40,0x40,0x50,0x20,0x00,
        0x00,0x00,0x50,0x70,0x70,0x50,0x50,0x00,
        0x00,0x00,0x60,0x50,0x50,0x50,0x50,0x00,
        0x00,0x00,0x20,0x50,0x50,0x50,0x20,0x00,
        0x00,0x00,0x60,0x50,0x50,0x60,0x40,0x40,
        0x00,0x00,0x30,0x50,0x50,0x30,0x10,0x10,
        0x00,0x00,0x60,0x50,0x40,0x40,0x40,0x00,
        0x00,0x00,0x30,0x40,0x20,0x10,0x60,0x00,
        0x00,0x40,0x70,0x40,0x40,0x50,0x20,0x00,
        0x00,0x00,0x50,0x50,0x50,0x50,0x20,0x00,
        0x00,0x00,0x50,0x50,0x50,0x20,0x20,0x00,
        0x00,0x00,0x50,0x50,0x70,0x70,0x50,0x00,
        0x00,0x00,0x50,0x50,0x20,0x50,0x50,0x00,
        0x00,0x00,0x50,0x50,0x30,0x10,0x50,0x20,
        0x00,0x00,0x70,0x10,0x20,0x40,0x70,0x00,
        0x00,0x00,0x10,0x20,0x60,0x20,0x10,0x00,
        0x00,0x20,0x20,0x20,0x20,0x20,0x20,0x00,
        0x00,0x00,0x40,0x20,0x30,0x20,0x40,0x00,
        0x00,0x00,0xA0,0x50,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    ]

    default_font_sizes = [
        6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
        6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
        6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
        6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
        6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
        6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
        6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
        6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,8,
        8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,
        4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
        4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
        4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
        4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
        4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
        4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
        4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,
    ]

    def __init__(self, font_chars=None, font_sizes=None):
        if font_chars is None:
            self.font_chars = self.default_font
        else:
            self.font_chars = font_chars
        if font_sizes is None:
            self.font_sizes = self.default_font_sizes
        else:
            self.font_sizes = font_sizes

    def getJson(self):
        charset = []
        for i in range(0, len(self.font_chars), 8):
            char = {"Id":int(i/8), "Character": self.font_chars[i:i+8], "Width":self.font_sizes[int(i/8)]}
            charset.append(char)
        return json.dumps(charset)

    def loadCharset(self, charset):
        chars = []
        sizes = []
        if charset is not None:
            charset = sorted(charset, key=lambda character: character["Id"])
            for ch in charset:
                chars = chars + ch["Character"]
                sizes.append(ch["Width"])
            if (len(chars) < len(self.font_chars)):
                chars = chars + self.font_chars[len(chars):]
            if (len(sizes) < len(self.font_sizes)):
                sizes = sizes + self.font_sizes[len(sizes):]
            self.font_chars = chars
            self.font_sizes = sizes
